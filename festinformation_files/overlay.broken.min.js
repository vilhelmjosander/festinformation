function VizzitOverlay(){var a=this;var f=null;var e=null;var c=null;var d=null;var b="//www.vizzit.se/overlay/broken/";this.cacheFixedLinks={};this.init=function(){var m=window.location.search.substr(1).split("&");for(var h=0;h<m.length;h++){var l=m[h];var n=l.indexOf("=");var g=l.substring(0,n);var k=l.substring(n+1,l.length);if(g==="vizzitO"){f=k}else{if(g==="vizzitD1"){e=k}else{if(g==="vizzitD2"){c=k}else{if(g==="vizzitS"){d=k}}}}}this.window()};this.run=function(){if(!a.check()){return false}a.load()};this.render=function(m){var existing = document.getElementById("vizzit-overlay");if(!existing){var l=document.getElementsByTagName("a");var k='<img class="vizzit-smiley" src="'+b+'img/smiley_big_sad.png" width="25" height="25" style="width:25px; height:25px;"/>';var p=function(q){var r=q.indexOf("://")+3;return q.substring(r)};var h=function(q){return(q.substring(q.length-1)==="/")};for(i in m.broken){for(j in l){if(l[j].href===undefined){continue}var o=p(l[j].href);var g=p(m.broken[i].url);if(h(o)&&!h(g)){o=o.substring(0,o.length-1)}if(o.indexOf(g)===-1){continue}if(o!=g){continue}l[j].setAttribute("style","color: #FF0000 !important");l[j].innerHTML+=k}}var n=document.createElement("div");n.id="vizzit-overlay";n.innerHTML=m.overlay;document.body.insertBefore(n,document.body.firstChild);document.body.className=document.body.className;a.addEvents()}};this.addEvents=function(){var g=document.getElementById("vizzit-open");g.onclick=null;g.addEventListener("click",a.open);var m=document.getElementById("vizzit-backdrop");m.onclick=null;m.addEventListener("click",a.close);var l=document.querySelector(".vizzit-close");l.onclick=null;l.addEventListener("click",a.close);var h=document.querySelector(".vizzit-close-holder");h.onclick=null;h.addEventListener("click",a.close);var p=document.querySelector(".vizzit-is-fixed-column .vizzit-icon");p.onclick=null;p.addEventListener("mouseenter",a.showLegend);var k=document.getElementById("vizzit-legend-popup");k.onclick=null;k.addEventListener("mouseleave",a.hideLegend);var n=document.querySelectorAll(".vizzit-is-fixed .vizzit-icon");for(i=0;i<n.length;i++){var o=n[i];o.onclick=null;o.addEventListener("click",a.onMarkClick)}};this.check=function(){if(f==="1"){return true}return false};this.load=function(){var g=b+"load.php";g+="?d1="+encodeURIComponent(e);g+="&d2="+encodeURIComponent(c);g+="&s="+d;g+="&u=//"+location.host+location.pathname;g+="&q="+location.search.replace("?","_q_u_e_s_t_").replace(/&/g,"_a_n_d_");if(location.search.indexOf("vizzitL=")>-1){g+="&l="+location.search.split("vizzitL=")[1].split("&")[0]}a.jsonp(g,"vizzitOverlayObject.render")};this.jsonp=function(h,k){var g=document.createElement("script");g.src=h+"&c="+k;document.getElementsByTagName("head")[0].appendChild(g)};this.window=function(){if($vizzit.lib.document.complete()){a.run()}else{if(window.addEventListener){window.addEventListener("load",a.run,false)}else{if(window.attachEvent){window.attachEvent("onload",a.run)}}}};this.close=function(){var g=document.getElementById("vizzit-open");var h=document.getElementById("vizzit-wrapper");g.className="";h.className="vizzit-hide"};this.open=function(){var g=document.getElementById("vizzit-open");var h=document.getElementById("vizzit-wrapper");g.className="vizzit-hide";h.className=""};this.onMarkClick=function(k){var m=k.target.parentNode.parentNode;var l=k.target.getAttribute("data-linkid");query="?d1="+encodeURIComponent(e);query+="&s="+d;query+="&p="+k.target.getAttribute("data-pageid");query+="&sp="+l;var n=document.getElementById("vizzit-wrapper");var h=n.getElementsByClassName("vizzit-fixed")[0];var g=n.getElementsByClassName("vizzit-broken")[0];if(l in a.cacheFixedLinks&&a.cacheFixedLinks[l]===true){a.reverseMarkAsFixed(k,m,l,query,h,g)}else{a.markAsFixed(k,m,l,query,g,h)}return true};this.markAsFixed=function(h,m,l,k,o,n){var g=b+"fix.php"+k;m.className+=" manually-fixed";a.cacheFixedLinks[l]=true;a.moveLink(m,o,n);a.jsonp(g,"vizzitOverlayObject.markAsFixedCallback");return true};this.reverseMarkAsFixed=function(h,m,l,k,o,n){var g=b+"reverse.php"+k;a.cacheFixedLinks[l]=false;m.className=m.className.replace(" manually-fixed","");a.moveLink(m,o,n);a.jsonp(g,"vizzitOverlayObject.reverseMarkAsFixedCallback");return true};this.moveLink=function(g,k,h){h.getElementsByTagName("tbody")[0].appendChild(g);a.updateOddRows(k);a.updateOddRows(h);a.updateCounts(k,h);a.showNoLinksMessage(k,h);return true};this.updateOddRows=function(k){var h=k.getElementsByClassName("vizzit-link-row");for(var g=0;g<h.length;g++){var l=h[g];l.className=l.className.replace(" vizzit-odd","");if(g%2===0){l.className+=" vizzit-odd"}}return true};this.updateCounts=function(n,m){var h=n.getElementsByTagName("span");var k=(a.getCurrentCount(n)-1);h[0].innerHTML=h[1].innerHTML=k;var l=m.getElementsByTagName("span");var g=(a.getCurrentCount(m)+1);l[0].innerHTML=l[1].innerHTML=g;return true};this.showNoLinksMessage=function(l,k){if(a.getCurrentCount(l)===0){var g=l.getElementsByClassName("vizzit-none")[0];g.className=g.className.replace(" vizzit-hide","")}if(a.getCurrentCount(k)===1){var h=k.getElementsByClassName("vizzit-none")[0];h.className+=" vizzit-hide"}return true};this.getCurrentCount=function(g){return parseInt(g.getElementsByTagName("span")[0].innerHTML)};this.markAsFixedCallback=function(g){if(g===false){alert("Could not fix the link.")}};this.reverseMarkAsFixedCallback=function(g){if(g===false){alert("Could not reverse link fix.")}};this.showLegend=function(){var g=document.getElementById("vizzit-legend-popup");g.className=g.className.replace(/\bvizzit-hide\b/,"")};this.hideLegend=function(){var g=document.getElementById("vizzit-legend-popup");g.className+=" vizzit-hide"}}var vizzitOverlayObject=new VizzitOverlay();vizzitOverlayObject.init();
